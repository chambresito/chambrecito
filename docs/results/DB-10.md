# DB-10: Add CHECK Constraints

## Status: Complete

## Description

Add CHECK constraints to enforce data integrity at the database level.

## Implementation Details

**Source File:** `supabase/migrations/001_init.sql`

### CHECK Constraints by Table

#### `markets`

| Constraint | Expression | Purpose |
|------------|------------|---------|
| `markets_time_window_chk` | `ends_at > starts_at` | Ensures valid time window |
| `markets_verification_chk` | `verification_required = false or verification_source_url is not null` | Ensures verification URL when required |

#### `predictions`

| Constraint | Expression | Purpose |
|------------|------------|---------|
| `predictions_choice_chk` | `choice in ('yes', 'no')` | Redundant with enum, belt-and-suspenders |

#### `token_ledger`

| Constraint | Expression | Purpose |
|------------|------------|---------|
| `token_ledger_amount_chk` | `amount > 0` | Ensures positive token amounts |

#### `market_snapshots`

| Constraint | Expression | Purpose |
|------------|------------|---------|
| `market_snapshots_counts_chk` | `total_predictions >= 0 and yes_count >= 0 and no_count >= 0` | Ensures non-negative counts |

#### `user_roles`

| Constraint | Expression | Purpose |
|------------|------------|---------|
| `user_roles_role_chk` | `role in ('admin', 'user')` | Restricts valid role values |

#### `reputation_points`

| Constraint | Expression | Purpose |
|------------|------------|---------|
| `reputation_points_amount_chk` | `points <> 0` | Ensures non-zero points (positive or negative) |

### Design Notes

- ENUMs provide type-level constraints, but some tables add CHECK constraints for extra safety
- The `markets_verification_chk` implements conditional required field logic
- Reputation points allow both positive and negative values (for potential future use) but not zero
