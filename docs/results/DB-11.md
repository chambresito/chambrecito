# DB-11: Add Indexes for Common Queries

## Status: Complete

## Description

Add indexes to optimize common query patterns.

## Implementation Details

**Source File:** `supabase/migrations/001_init.sql`

### Indexes by Table

#### `markets`

| Index | Column(s) | Type | Purpose |
|-------|-----------|------|---------|
| `markets_source_topic_id_uidx` | `source_topic_id` | UNIQUE | Idempotent ingest from X API |
| `markets_status_idx` | `status` | B-tree | Filter by market status |
| `markets_topic_slug_idx` | `topic_slug` | B-tree | URL routing |
| `markets_subject_type_idx` | `subject_type` | B-tree | Filter by subject type |

#### `predictions`

| Index | Column(s) | Type | Purpose |
|-------|-----------|------|---------|
| `predictions_idempotency_uidx` | `idempotency_key` | UNIQUE | Idempotent prediction placement |
| `predictions_market_idx` | `market_id` | B-tree | Join/filter by market |
| `predictions_user_idx` | `user_id` | B-tree | User's prediction history |

#### `token_ledger`

| Index | Column(s) | Type | Purpose |
|-------|-----------|------|---------|
| `token_ledger_vudy_tx_uidx` | `vudy_tx_id` | UNIQUE | Idempotent ledger entries |
| `token_ledger_user_idx` | `user_id` | B-tree | User's ledger history |
| `token_ledger_market_idx` | `market_id` | B-tree | Market token activity |

#### `market_snapshots`

| Index | Column(s) | Type | Purpose |
|-------|-----------|------|---------|
| `market_snapshots_market_idx` | `market_id` | B-tree | Snapshots for a market |
| `market_snapshots_time_idx` | `snapshot_at` | B-tree | Time-series queries |

#### `reputation_points`

| Index | Column(s) | Type | Purpose |
|-------|-----------|------|---------|
| `reputation_points_unique_uidx` | `(user_id, market_id, reason)` | UNIQUE | Prevent duplicate awards |

### Unique Indexes

Four unique indexes enforce business rules:
1. One topic per source ID (idempotent ingest)
2. One prediction per idempotency key (idempotent placement)
3. One vudy transaction per ledger entry (idempotent consumption)
4. One reputation award per user/market/reason combination

### Design Notes

- All foreign key columns have indexes for efficient joins
- Status/type columns indexed for common filter patterns
- Time-based index on `market_snapshots` for time-series queries
