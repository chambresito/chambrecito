# DB-12: Add Comments Explaining Table/Column Intent

## Status: Complete

## Description

Add PostgreSQL comments to document table and column purposes.

## Implementation Details

**Source File:** `supabase/migrations/001_init.sql`

### Table Comments

| Table | Comment |
|-------|---------|
| `markets` | "Auto-ingested prediction topics from X API." |
| `predictions` | "User predictions; immutable and append-only." |
| `token_ledger` | "Immutable append-only mirror of vudy consumption." |
| `resolution_rules` | "Deterministic resolution rules per market." |
| `market_snapshots` | "Derived counts for market trend visualization." |
| `user_roles` | "Internal mirror of user role; JWT claim is source of truth." |
| `reputation_points` | "Non-monetary reputation system, separate from tokens." |

### Column Comments

#### `markets`

| Column | Comment |
|--------|---------|
| `source_topic_id` | "Stable ID from X source; used for idempotent ingest." |
| `resolution_evidence` | "Deterministic evidence used for resolution." |
| `subject_type` | "Categorization for safety rules; public_figure enforced for chisme markets." |
| `verification_required` | "True when external verification is required." |
| `verification_source_url` | "Public URL used to verify the market outcome." |

#### `predictions`

| Column | Comment |
|--------|---------|
| `idempotency_key` | "Stable key for idempotent prediction placement." |

#### `token_ledger`

| Column | Comment |
|--------|---------|
| `vudy_tx_id` | "Unique transaction ID from vudy.com." |

### Function Comments

| Function | Comment |
|----------|---------|
| `is_admin()` | "Checks JWT role claim for admin." |
| `award_reputation_points()` | "Awards reputation points to correct predictions." |
| `place_prediction_tx()` | "Atomic prediction placement, ledger mirror, and snapshot." |

### Comment Syntax

```sql
comment on table markets is 'Auto-ingested prediction topics from X API.';
comment on column markets.source_topic_id is 'Stable ID from X source; used for idempotent ingest.';
comment on function is_admin() is 'Checks JWT role claim for admin.';
```

### Design Notes

- Comments focus on "why" rather than "what"
- Key business rules and constraints are documented
- Source of truth relationships are explicitly noted
