# DB-04: Create `resolution_rules` table

## Status: Complete

## Description

Create the `resolution_rules` table for storing deterministic resolution logic for markets.

## Implementation Details

**Source File:** `supabase/migrations/001_init.sql`

### Table Schema

```sql
create table if not exists resolution_rules (
  id uuid primary key default gen_random_uuid(),
  name text not null,
  source text not null,
  rule_json jsonb not null,
  deterministic boolean not null default true,
  created_at timestamptz not null default now()
);
```

### Foreign Key Relationship

Markets reference resolution rules via:

```sql
alter table markets
  add constraint markets_resolution_rule_fk
  foreign key (resolution_rule_id)
  references resolution_rules(id)
  on delete set null;
```

### Comments

- Table: "Deterministic resolution rules per market."

## Deviations from Original Spec

| Original Spec | Actual Implementation |
|---------------|----------------------|
| `market_id` field (FK to markets) | `id` referenced by `markets.resolution_rule_id` (inverse relationship) |
| `rule_type` field | `name` field |
| `source_url` field | `source` field |
| `expected_outcome` field | Stored in `rule_json` JSONB |
| No `rule_json` | Added for flexible rule storage |
| No `deterministic` flag | Added to indicate rule determinism |

### Design Note

The relationship was inverted: instead of resolution rules referencing markets, markets reference resolution rules. This allows multiple markets to share the same resolution rule and is more normalized.
