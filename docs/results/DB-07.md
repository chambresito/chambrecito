# DB-07: Create `reputation_points` table

## Status: Complete

## Description

Create the `reputation_points` table for storing non-monetary reputation points, separate from token logic.

## Implementation Details

**Source File:** `supabase/migrations/001_init.sql`

### Table Schema

```sql
create table if not exists reputation_points (
  id uuid primary key default gen_random_uuid(),
  user_id uuid not null,
  market_id uuid not null references markets(id) on delete restrict,
  points integer not null,
  reason reputation_reason not null,
  created_at timestamptz not null default now()
);
```

### ENUMs

- `reputation_reason`: `'market_resolution'`

### Constraints

- `reputation_points_amount_chk`: Ensures `points <> 0`
- Foreign key to `markets(id)` with `on delete restrict`

### Indexes

- `reputation_points_unique_uidx`: Unique index on `(user_id, market_id, reason)`

### Comments

- Table: "Non-monetary reputation system, separate from tokens."

### Helper Function

```sql
create or replace function award_reputation_points(
  p_market_id uuid,
  p_outcome boolean
)
returns integer
```

Awards 10 reputation points to users who predicted correctly when a market resolves.

## Deviations from Original Spec

| Original Spec | Actual Implementation |
|---------------|----------------------|
| No `reason` field | Added `reason` enum for tracking why points were awarded |
| No unique constraint | Unique index on `(user_id, market_id, reason)` prevents duplicate awards |
| No helper function | Added `award_reputation_points()` function |

### Design Note

The unique index on `(user_id, market_id, reason)` ensures each user can only receive one reputation award per market per reason, preventing duplicate awards during resolution.
