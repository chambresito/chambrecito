# DB-06: Create `user_roles` table

## Status: Complete

## Description

Create the `user_roles` table for storing user role assignments (admin vs user).

## Implementation Details

**Source File:** `supabase/migrations/001_init.sql`

### Table Schema

```sql
create table if not exists user_roles (
  user_id uuid primary key,
  role text not null,
  created_at timestamptz not null default now()
);
```

### Constraints

- `user_roles_role_chk`: Ensures `role in ('admin', 'user')`
- `user_id` is the primary key (one role per user)

### Comments

- Table: "Internal mirror of user role; JWT claim is source of truth."

## Deviations from Original Spec

| Original Spec | Actual Implementation |
|---------------|----------------------|
| `id` field (separate PK) | `user_id` is the primary key |
| Role ENUM type | TEXT with CHECK constraint |

### Design Note

The JWT claim is the source of truth for authorization. This table serves as an internal mirror for reference purposes. The `is_admin()` helper function checks the JWT claim directly:

```sql
create or replace function is_admin()
returns boolean
language sql
stable
as $$
  select coalesce(auth.jwt() ->> 'role', '') = 'admin';
$$;
```
